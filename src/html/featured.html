<div class="pure-g">
  <div class="pure-u-1 pure-u-sm-2-3">
    <div id="featured-0" class="featured">
      <img src="/imgs/featured/vega-lite.png" alt="">
      <div class="overlay"></div>
      <p class="caption">
        Vega-Lite: A Grammar of Interactive Graphics &rarr;
      </p>
    </div>
  </div>

  <div class="pure-hidden-xs pure-u-sm-1-3">
    <div class="pure-g">
      <div class="pure-u-1-2 pure-u-sm-1">
        <div id="featured-1" class="featured">
          <img src="/imgs/featured/interpretability-building-blocks.png" alt="">
          <div class="overlay"></div>
          <p class="caption">
            The Building Blocks of Interpretability &rarr;
          </p>
        </div>
      </div>

      <div class="pure-u-1-2 pure-u-sm-1">
        <div id="featured-2" class="featured">
          <img src="/imgs/featured/lyra.png" alt="">
          <div class="overlay"></div>
          <p class="caption">
            Lyra: A Visualization Design Environment &rarr;
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  (function() {
    var data = {{{featured papers}}},
        FADE = 1000, PAUSE = 5000,
        counter = 0, spot = 0;

    function numSpots() { // To account for show/hide responsiveness.
      var nodes = d3.selectAll('.featured').nodes()
        .filter(n => n.offsetParent);
      return nodes.length;
    }

    function imgsrc(paper) {
      return `/imgs/featured/${paper.slug}.png`;
    }

    function caption(paper) {
      return paper.featTitle || paper.title;
    }

    function loadFeatured() {
      var paper = data[counter],
          el = d3.select(`#featured-${spot}`),
          img = new Image(),
          src = imgsrc(paper);

      img.src = src;
      img.onload = function() {
        el.style('opacity', 1.0)
          .transition().duration(FADE/2)
          .style('opacity', 0.0)
          .on('end', function() {
            el.select('img').attr('src', src);
            el.select('.caption').html(caption(paper));
            el.style('opacity', 0.0)
              .transition().duration(FADE/2)
              .style('opacity', 1.0)
              .on('end', function() {
                if (++counter >= data.length) counter = 0;
                if (++spot >= numSpots()) spot = 0;
              });
          });
      };
    }

    var paper, el;
    for(; counter < numSpots(); counter++) {
      paper = data[counter];
      el = d3.select(`#featured-${spot++}`);
      el.select('img').attr('src', imgsrc(paper));
      el.select('.caption').html(caption(paper));
    }

    if (spot >= numSpots()) spot = 0;
    setInterval(loadFeatured, PAUSE);
  })();
</script>
